<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Логопарк - Пропуск для персонала</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f5f7fa;
            color: #333;
        }
        
        /* Шапка */
        .top-header {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .company-info h1 {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .company-info p {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logout-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        /* Навигация */
        .sub-nav {
            background: white;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .sub-nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            overflow-x: auto;
        }
        
        .nav-links a {
            display: block;
            padding: 15px 20px;
            text-decoration: none;
            color: #555;
            font-weight: 500;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .nav-links a:hover,
        .nav-links a.active {
            color: #1a237e;
            border-bottom-color: #1a237e;
            background: #f8f9fa;
        }
        
        /* Основной контент */
        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .page-header {
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eaeaea;
        }
        
        .page-header h1 {
            color: #1a237e;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .page-header p {
            color: #666;
            margin-top: 10px;
        }
        
        /* Карточка формы */
        .form-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .form-card-header {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 25px 30px;
        }
        
        .form-card-header h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 22px;
        }
        
        .form-card-body {
            padding: 30px;
        }
        
        /* Форма */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .form-section {
            margin-bottom: 30px;
        }
        
        .form-section h3 {
            color: #1a237e;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }
        
        .form-group label.required:after {
            content: " *";
            color: #f44336;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
            background: white;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3f51b5;
            box-shadow: 0 0 0 3px rgba(63, 81, 181, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .form-row,
            .form-row-3 {
                grid-template-columns: 1fr;
            }
        }
        
        /* Кнопки */
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            padding-top: 30px;
            border-top: 1px solid #eee;
            margin-top: 30px;
        }
        
        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }
        
        .btn-outline {
            background: white;
            color: #666;
            border: 2px solid #ddd;
        }
        
        .btn-outline:hover {
            background: #f5f5f5;
            border-color: #bbb;
        }
        
        /* Иконки в полях */
        .input-with-icon {
            position: relative;
        }
        
        .input-with-icon input {
            padding-left: 45px;
        }
        
        .input-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-size: 18px;
        }
        
        /* Таблица сотрудников */
        .staff-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-top: 30px;
        }
        
        .table-header {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #f5f7fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e0e0e0;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            color: #555;
        }
        
        tr:hover {
            background: #f9f9f9;
        }
        
        /* Статусы */
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-active {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .status-expired {
            background: #ffebee;
            color: #c62828;
        }
        
        /* Предпросмотр пропуска */
        .pass-preview {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 2px dashed #ddd;
            display: none;
        }
        
        .pass-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #1a237e;
        }
        
        .pass-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .pass-item {
            padding: 10px 0;
        }
        
        .pass-label {
            font-weight: 600;
            color: #666;
            font-size: 13px;
            margin-bottom: 5px;
        }
        
        .pass-value {
            color: #333;
            font-size: 16px;
            font-weight: 500;
        }
        
        .pass-qr {
            text-align: center;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .qr-placeholder {
            width: 150px;
            height: 150px;
            background: white;
            border: 2px dashed #ccc;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
        }
        
        /* Адаптивность */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .table-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Шапка -->
    <header class="top-header">
        <div class="nav-container">
            <div class="company-info">
                <h1>Логопарк Менеджмент</h1>
                <p>ИНН: 5040071960</p>
            </div>
            
            <div class="user-menu">
                <span>Пользователь: 5040071960</span>
                <button class="logout-btn" onclick="logout()">Выйти</button>
            </div>
        </div>
    </header>

    <!-- Навигация -->
    <nav class="sub-nav">
        <div class="sub-nav-container">
            <ul class="nav-links">
                <li><a href="main.html">Главная</a></li>
                <li><a href="sessions.html">Сессии проезда</a></li>
                <li><a href="create-ticket.html">Гостевой пропуск</a></li>
                <li><a href="one-time-staff.html" class="active">Пропуск персонала</a></li>
                <li><a href="permanent-pass.html">Постоянный пропуск</a></li>
                <li><a href="reports.html">Отчеты</a></li>
                <li><a href="settings.html">Настройки</a></li>
            </ul>
        </div>
    </nav>

    <!-- Основной контент -->
    <div class="container">
        <div class="page-header">
            <h1><i class="fas fa-id-card"></i> Одноразовый пропуск для персонала</h1>
            <p>Создание временного пропуска для сотрудников организации</p>
        </div>

        <!-- Уведомления -->
        <div id="successAlert" style="display: none;" class="alert alert-success">
            <i class="fas fa-check-circle"></i> Пропуск успешно создан!
        </div>

        <!-- Форма создания пропуска -->
        <div class="form-card">
            <div class="form-card-header">
                <h2><i class="fas fa-user-plus"></i> Создание одноразового пропуска</h2>
            </div>
            
            <div class="form-card-body">
                <form id="staffPassForm">
                    <div class="form-section">
                        <h3><i class="fas fa-user"></i> Данные сотрудника</h3>
                        
                        <div class="form-row-3">
                            <div class="form-group">
                                <label for="lastName" class="required">Фамилия</label>
                                <div class="input-with-icon">
                                    <i class="fas fa-user input-icon"></i>
                                    <input type="text" id="lastName" placeholder="Иванов" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="firstName" class="required">Имя</label>
                                <div class="input-with-icon">
                                    <i class="fas fa-user input-icon"></i>
                                    <input type="text" id="firstName" placeholder="Иван" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="middleName">Отчество</label>
                                <div class="input-with-icon">
                                    <i class="fas fa-user input-icon"></i>
                                    <input type="text" id="middleName" placeholder="Иванович">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="department" class="required">Подразделение</label>
                            <div class="input-with-icon">
                                <i class="fas fa-building input-icon"></i>
                                <select id="department" required>
                                    <option value="">Выберите подразделение</option>
                                    <option value="it">IT отдел</option>
                                    <option value="hr">HR отдел</option>
                                    <option value="finance">Финансовый отдел</option>
                                    <option value="logistics">Логистика</option>
                                    <option value="security">Служба безопасности</option>
                                    <option value="management">Руководство</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="passReason">Цель получения пропуска</label>
                            <div class="input-with-icon">
                                <i class="fas fa-file-alt input-icon"></i>
                                <select id="passReason">
                                    <option value="">Не выбрано</option>
                                    <option value="temporary_access">Временный доступ (ремонт, обслуживание)</option>
                                    <option value="new_employee">Новый сотрудник (ожидание постоянного пропуска)</option>
                                    <option value="replacement">Замена утерянного/поврежденного пропуска</option>
                                    <option value="contractor">Внешний подрядчик</option>
                                    <option value="other">Иная причина</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3><i class="fas fa-calendar-alt"></i> Срок действия пропуска</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="passStart" class="required">Дата и время начала</label>
                                <div class="input-with-icon">
                                    <i class="fas fa-calendar-plus input-icon"></i>
                                    <input type="datetime-local" id="passStart" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="passEnd" class="required">Дата и время окончания</label>
                                <div class="input-with-icon">
                                    <i class="fas fa-calendar-minus input-icon"></i>
                                    <input type="datetime-local" id="passEnd" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <button type="button" class="btn btn-outline" onclick="set24Hours()">
                                <i class="fas fa-clock"></i> Установить 24 часа
                            </button>
                        </div>
                    </div>
                    
                    <!-- Кнопки действий -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="clearForm()">
                            <i class="fas fa-trash-alt"></i> Очистить форму
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="previewPass()">
                            <i class="fas fa-eye"></i> Предпросмотр
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check-circle"></i> Создать пропуск
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Предпросмотр пропуска -->
        <div class="pass-preview" id="passPreview">
            <div class="pass-header">
                <h2 style="color: #1a237e;">ПРЕДПРОСМОТР ПРОПУСКА</h2>
                <p>Одноразовый пропуск для персонала</p>
            </div>
            
            <div class="pass-content" id="previewContent">
                <!-- Данные будут загружены через JavaScript -->
            </div>
            
            <div class="pass-qr">
                <div class="qr-placeholder">
                    QR-код будет<br>сгенерирован<br>после создания
                </div>
                <p><strong>Для активации отсканируйте QR-код</strong></p>
                <p style="font-size: 12px; color: #666;">QR-код содержит всю информацию о пропуске</p>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="printPass()">
                    <i class="fas fa-print"></i> Распечатать пропуск
                </button>
            </div>
        </div>
        
        <!-- Список созданных пропусков -->
        <div class="staff-table">
            <div class="table-header">
                <h3><i class="fas fa-list"></i> Последние созданные пропуска</h3>
                <button class="btn btn-outline" onclick="refreshList()">
                    <i class="fas fa-sync-alt"></i> Обновить список
                </button>
            </div>
            
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>№ Пропуска</th>
                            <th>Сотрудник</th>
                            <th>Подразделение</th>
                            <th>Срок действия</th>
                            <th>Статус</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody id="passesList">
                        <!-- Данные будут загружены через JavaScript -->
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: #999;">
                                <i class="fas fa-info-circle" style="font-size: 24px; margin-bottom: 10px; display: block;"></i>
                                Созданные пропуска появятся здесь
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Проверка авторизации
        if (localStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'index.html';
        }

        // Установка дат по умолчанию
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setHours(tomorrow.getHours() + 24);
            
            // Форматирование для datetime-local
            const formatDateTime = (date) => {
                return date.toISOString().slice(0, 16);
            };
            
            document.getElementById('passStart').value = formatDateTime(now);
            document.getElementById('passEnd').value = formatDateTime(tomorrow);
        });

        // Генерация номера пропуска
        function generatePassNumber() {
            const prefix = 'STAFF';
            const date = new Date();
            const dateStr = date.getFullYear().toString().slice(-2) + 
                          (date.getMonth() + 1).toString().padStart(2, '0') + 
                          date.getDate().toString().padStart(2, '0');
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            return prefix + dateStr + random;
        }

        // Установить 24 часа с текущего момента
        function set24Hours() {
            const now = new Date();
            const endTime = new Date(now);
            endTime.setHours(endTime.getHours() + 24);
            
            document.getElementById('passStart').value = now.toISOString().slice(0, 16);
            document.getElementById('passEnd').value = endTime.toISOString().slice(0, 16);
        }

        // Предпросмотр пропуска
        function previewPass() {
            const form = document.getElementById('staffPassForm');
            
            // Проверяем только обязательные поля (без passReason)
            const requiredFields = ['lastName', 'firstName', 'department', 'passStart', 'passEnd'];
            let isValid = true;
            
            for (const fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.focus();
                    alert(`Пожалуйста, заполните обязательное поле: ${field.labels[0].textContent}`);
                    isValid = false;
                    break;
                }
            }
            
            if (!isValid) return;
            
            // Собираем ФИО
            const lastName = document.getElementById('lastName').value;
            const firstName = document.getElementById('firstName').value;
            const middleName = document.getElementById('middleName').value;
            const fullName = `${lastName} ${firstName} ${middleName}`.trim();
            
            // Получаем цель пропуска
            const passReasonSelect = document.getElementById('passReason');
            const passReason = passReasonSelect.value ? 
                passReasonSelect.selectedOptions[0].text : 
                'Не указана';
            
            const previewData = {
                'Номер пропуска': generatePassNumber(),
                'ФИО сотрудника': fullName,
                'Фамилия': lastName,
                'Имя': firstName,
                'Отчество': middleName || 'Не указано',
                'Подразделение': document.getElementById('department').selectedOptions[0].text,
                'Цель получения': passReason,
                'Дата начала': formatDateTimeDisplay(document.getElementById('passStart').value),
                'Дата окончания': formatDateTimeDisplay(document.getElementById('passEnd').value)
            };
            
            const previewContent = document.getElementById('previewContent');
            previewContent.innerHTML = '';
            
            for (const [key, value] of Object.entries(previewData)) {
                const item = document.createElement('div');
                item.className = 'pass-item';
                item.innerHTML = `
                    <div class="pass-label">${key}</div>
                    <div class="pass-value">${value}</div>
                `;
                previewContent.appendChild(item);
            }
            
            document.getElementById('passPreview').style.display = 'block';
            
            // Прокрутка к предпросмотру
            document.getElementById('passPreview').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }

        // Форматирование даты для отображения
        function formatDateTimeDisplay(dateTimeStr) {
            if (!dateTimeStr) return 'Не указано';
            
            const date = new Date(dateTimeStr);
            return date.toLocaleString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Очистка формы
        function clearForm() {
            if (confirm('Вы уверены, что хотите очистить все поля формы?')) {
                document.getElementById('staffPassForm').reset();
                document.getElementById('passPreview').style.display = 'none';
                
                // Сброс дат к значениям по умолчанию (24 часа с текущего момента)
                const now = new Date();
                const tomorrow = new Date(now);
                tomorrow.setHours(tomorrow.getHours() + 24);
                
                document.getElementById('passStart').value = now.toISOString().slice(0, 16);
                document.getElementById('passEnd').value = tomorrow.toISOString().slice(0, 16);
            }
        }

        // Печать пропуска
        function printPass() {
            const printContent = document.getElementById('passPreview').innerHTML;
            const originalContent = document.body.innerHTML;
            
            document.body.innerHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Печать пропуска</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .print-pass { border: 3px solid #000; padding: 40px; max-width: 800px; margin: 0 auto; }
                        .print-header { text-align: center; margin-bottom: 30px; }
                        .print-header h1 { color: #1a237e; margin-bottom: 10px; }
                        .print-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
                        .print-item { margin-bottom: 15px; }
                        .print-label { font-weight: bold; color: #333; }
                        .print-qr { text-align: center; margin: 30px 0; }
                        .footer { text-align: center; margin-top: 30px; font-size: 12px; color: #666; }
                        @media print {
                            .no-print { display: none; }
                            .print-pass { border: none; padding: 0; }
                        }
                    </style>
                </head>
                <body>
                    <div class="print-pass">
                        <div class="print-header">
                            <h1>ОДНОРАЗОВЫЙ ПРОПУСК ДЛЯ ПЕРСОНАЛА</h1>
                            <h3>Логопарк Менеджмент</h3>
                            <p>ИНН: 5040071960</p>
                        </div>
                        
                        <div class="print-grid">
                            ${document.getElementById('previewContent').innerHTML.replace(/pass-label/g, 'print-label').replace(/pass-value/g, 'print-value')}
                        </div>
                        
                        <div class="print-qr">
                            <div style="border: 2px solid #000; width: 180px; height: 180px; margin: 0 auto; display: flex; align-items: center; justify-content: center;">
                                <div style="text-align: center; padding: 10px;">
                                    <div style="font-size: 14px; font-weight: bold;">QR-КОД</div>
                                    <div style="font-size: 10px; margin-top: 5px;">Для сканирования<br>на въезде</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="footer">
                            <p>Пропуск действителен только при предъявлении служебного удостоверения</p>
                            <p>Срок действия: ${document.getElementById('passStart').value} - ${document.getElementById('passEnd').value}</p>
                            <p>Дата печати: ${new Date().toLocaleDateString('ru-RU')}</p>
                        </div>
                    </div>
                    
                    <div class="no-print" style="text-align: center; margin-top: 20px;">
                        <button onclick="window.print()" style="padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">Печатать</button>
                        <button onclick="document.body.innerHTML = originalContent; location.reload();" style="padding: 10px 20px; background: #666; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">Закрыть</button>
                    </div>
                </body>
                </html>
            `;
            
            window.print();
        }

        // Обновление списка пропусков
        function refreshList() {
            const passesList = document.getElementById('passesList');
            // В реальном проекте здесь будет загрузка данных с сервера
            
            // Пример данных
            const examplePasses = [
                {
                    id: 'STAFF240101001',
                    name: 'Иванов И.И.',
                    department: 'IT отдел',
                    endDate: '15.01.2024 18:30',
                    status: 'Активен'
                },
                {
                    id: 'STAFF240101002',
                    name: 'Петров П.П.',
                    department: 'HR отдел',
                    endDate: '10.01.2024 12:00',
                    status: 'Истек'
                }
            ];
            
            passesList.innerHTML = '';
            
            examplePasses.forEach(pass => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${pass.id}</td>
                    <td>${pass.name}</td>
                    <td>${pass.department}</td>
                    <td>до ${pass.endDate}</td>
                    <td><span class="status-badge ${pass.status === 'Активен' ? 'status-active' : 'status-expired'}">${pass.status}</span></td>
                    <td>
                        <button class="btn-outline" style="padding: 5px 10px; font-size: 12px;" onclick="viewPass('${pass.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-outline" style="padding: 5px 10px; font-size: 12px;" onclick="printPassById('${pass.id}')">
                            <i class="fas fa-print"></i>
                        </button>
                    </td>
                `;
                passesList.appendChild(row);
            });
        }

        // Просмотр конкретного пропуска
        function viewPass(passId) {
            alert(`Просмотр пропуска: ${passId}\nВ реальном проекте здесь будет открытие детальной информации.`);
        }

        // Печать конкретного пропуска
        function printPassById(passId) {
            alert(`Печать пропуска: ${passId}\nВ реальном проекте здесь будет печать выбранного пропуска.`);
        }

        // Обработка отправки формы
        document.getElementById('staffPassForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Проверяем обязательные поля
            const requiredFields = ['lastName', 'firstName', 'department', 'passStart', 'passEnd'];
            for (const fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    alert(`Пожалуйста, заполните обязательное поле: ${field.labels[0].textContent}`);
                    field.focus();
                    return;
                }
            }
            
            // Сбор данных формы
            const lastName = document.getElementById('lastName').value;
            const firstName = document.getElementById('firstName').value;
            const middleName = document.getElementById('middleName').value;
            
            // Получаем цель пропуска
            const passReasonSelect = document.getElementById('passReason');
            const passReason = passReasonSelect.value;
            const passReasonName = passReasonSelect.value ? 
                passReasonSelect.selectedOptions[0].text : 
                '';
            
            const passData = {
                id: generatePassNumber(),
                lastName: lastName,
                firstName: firstName,
                middleName: middleName,
                fullName: `${lastName} ${firstName} ${middleName}`.trim(),
                department: document.getElementById('department').value,
                departmentName: document.getElementById('department').selectedOptions[0].text,
                passReason: passReason,
                passReasonName: passReasonName,
                passStart: document.getElementById('passStart').value,
                passEnd: document.getElementById('passEnd').value,
                created: new Date().toISOString(),
                createdBy: '5040071960',
                status: 'active'
            };
            
            // Сохранение в localStorage (в реальном проекте - отправка на сервер)
            let passes = JSON.parse(localStorage.getItem('staffPasses') || '[]');
            passes.push(passData);
            localStorage.setItem('staffPasses', JSON.stringify(passes));
            
            // Показать уведомление об успехе
            const alert = document.getElementById('successAlert');
            alert.innerHTML = `<i class="fas fa-check-circle"></i> Пропуск успешно создан! Номер: <strong>${passData.id}</strong>`;
            alert.style.display = 'block';
            alert.style.background = '#d4edda';
            alert.style.color = '#155724';
            alert.style.padding = '15px';
            alert.style.borderRadius = '5px';
            alert.style.marginBottom = '20px';
            
            // Обновить список пропусков
            refreshList();
            
            // Прокрутить к уведомлению
            alert.scrollIntoView({ behavior: 'smooth' });
            
            // Автоматически скрыть уведомление через 5 секунд
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
            
            // Показать предпросмотр с новым номером пропуска
            previewPass();
        });

        // Функция выхода
        function logout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>